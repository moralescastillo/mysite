---
layout: post
title: 'A Runner's Tale about Plantar Fasciitis'
subtitle: 'Pain, Recovery, and Rediscovering the Joy of Running'
description: 'The story of a rollercoaster ride dealing with foot inflammation and my journey back to running'
date: 2023-09-08 09:34:00 +0200
author: paulo
image: '/images/2023-09-98-runner-plantar-fasciitis-img00.jpg'
image_caption: 'Photo by [Marcel Ardivan](https://unsplash.com/@pretentiousmaru?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/photos/Uhbf6jdnOsA?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)'
tags: [running]
feature:
---    

<!---
Photo by <a href="https://unsplash.com/@pretentiousmaru?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Marcel Ardivan</a> on <a href="https://unsplash.com/photos/Uhbf6jdnOsA?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>
  --->


"I have no idea how I developed plantar fasciitis," I shared to my friend as we discussed my injury, the one that had stopped me from running. "My doctor said it commonly affects endurance athletes and overweight people who frequently wear high heels."

"And which category do you fall into?" my friend asked with a serious look.

Plantar fasciitis is a medical condition characterized by inflammation of the plantar fascia, a thick band of tissue that runs along the bottom of the foot. This inflammation typically leads to sharp and persistent pain, often focused on the heel. The pain tends to worsen with activities such as standing, walking, and specially running.  

### where did it come from?

I was taken by surprise when I first felt the pain in my heel. I thought my first serious running ailment would involve my knees, like many other runners experience. After a decade of pain-free running, having heel pain was quite unexpected. What I know for certain is that my problems with plantar fasciitis started in the middle of June 2022 while I was in Morocco.

A month earlier, I had a fall while surf skating in Lisbon. I was practicing turns on a half-pipe, and I fell, absorbing the impact on my right arm. Since then (and up to this day), my right shoulder tenses up whenever I tilt my head backward. It's possible that the discomfort in my neck and shoulder contributed to tension in other parts of my body, thus causing inflammation of the fascia in my foot.

Another theory links my pain to running on sand. Around the time my pain began, I was averaging about 30 km a week, mostly on sandy terrains. This was quite a load for me, as I wasn't used to this surface. it turns out, running on sand places extra strain on the fascia in the feet. Despite discomfort, I continued running (thank you for the inspiration Mr. Goggins!). I embraced the pain and pushed through. Eventually, I had to stop; the situation was far from normal.

![2023-09-98-runner-plantar-fasciitis-img01](/images/2023-09-98-runner-plantar-fasciitis-img01.jpg){:loading="lazy"}
<font size="-1"><center><span> A 14km out-and-back in Essaouira, Morocco </span></center></font>
<br>

Stress also played a substantial role, I believe. During that period, I was going through a highly stressful time in my life. Like many runners, I use running as a form of therapy, a way to seek answers to the many questions in my mind. This stressful phase likely resulted in less sleep and a poor diet, which, when combined with strenuous physical activity, can lead to adverse consequences.


I would like to think it was a combination of all the above rather than a single cause. Perhaps it was simply bound to happen sooner or later? The reality is that I now have plantar fasciitis, and dwelling on how I got here won't help. Instead, I need to focus on finding ways to alleviate the pain in the future. 


### how does it feel?

One day, I woke up and simply couldn't put my left foot on the floor. Whether with or without shoes, the pain was unbearable. I had no choice but to stop running.

However, my habits persisted. I continued eating the same amount of carbs as if I were still running regularly. Not surprisingly, I began to gain weight. This created a vicious cycle of pain because I was now putting more strain on my foot.

![2023-09-98-runner-plantar-fasciitis-img02](/images/2023-09-98-runner-plantar-fasciitis-img02.jpg){:loading="lazy"}
<font size="-1"><center><span> X-ray of my heel spurs, the result of prolonged tension on the plantar fascia </span></center></font>
<br>

If the physical pain wasn't bothersome enough, then came the mental distress. Running is my muse, my sanctuary. It's where I go to celebrate victories and escape when things aren't going well. In an interconnected world, running is the ultimate escape for introverts like me, something I could do virtually anywhere in the world. Now that was gone, and the mental distress was building up.

Unfortunately, empathy was not abundant. At the time, not many people around me could understand the distress I was going through. "But you can still walk, right?" was a common response from my friends when I explained the situation. I don't blame them. It takes runners who have experienced injuries themselves to truly understand what it feels like to be stranded, both physically and mentally.


### how does it go away?

The internet had plenty to say about plantar fasciitis. Many of the sources contradicted each other, which added to the frustration.

After returning from Morocco and enduring weeks of forced rest, the pain would subside a bit, only to return with a vengeance whenever I went for a walk around the park. I soon realized I needed professional help, and I needed it fast.

In the following five months, I consulted several specialists, including a physiotherapist, a general orthopedist, a sports orthopedist, an osteopath, a hands and feet orthopedist, a nutritionist, and a chiropractor.

My body soon became a laboratory. Among some of the most notable methods I tried to alleviate my pain were:

* Anti-inflammatories
* Fascia release
* Heel insoles
* A lectin-free diet
* A full-body stretching routine
* Stride analysis and new brands of running shoes
* Ultrasound therapy (have you ever wondered what it feels like to have a nail pounded into your heel?)
* Feet-specific workouts

Add to the list above all the unsolicited advice I received from everyone who heard my story. It turns out that everyone in my family back in Colombia knows someone who once had plantar fasciitis. And they all talked about nopal cactus leaves.

![2023-09-98-runner-plantar-fasciitis-img03](/images/2023-09-98-runner-plantar-fasciitis-img03.jpg){:loading="lazy"}
<font size="-1"><center><span> Nopal cactus leaves by <a href="https://unsplash.com/@acton_crawford?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Acton Crawford</a> on <a href="https://unsplash.com/photos/IBFg0bNRDz8?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a> </span></center></font>
<br>


This home remedy involves finding two nopal leaves and placing them under your feet. Then trace the outline of your feet on both leaves and carve out the surface of the leaf to expose the sabila-like substance inside. Place your feet back on the leaves and wait for 30 minutes. Finally, proceed to hang the leaves somewhere in your house. Your feet will supposedly be cured by the time the leaves dry up. This method sounded less reliable than the lectin-free diet.


### how do you live with it?

My physiotherapist once said something that resonated with me for a long time. She said, "Sometimes the best solution is to be ready to heal." Specialists can only act as consultants in the enterprise that is your own health. But it is up to you to be ready; the healing part is all on our shoulders. Was I ready to heal?


In February, I was back on my feet. Not yet physically, but mentally. I had shed 8 kilos in weight, started eating healthier, and felt stronger thanks to a new series of stretching and workout routines. So I started running again. Slowly but surely. Ten minutes at a time. Fifteen minutes at a time. Twenty minutes at a time. The inflammation persisted, but the pain was much lower than it had been in the beginning.

Being in nature significantly improved my mental state. For the first time, I truly appreciated the luxury of running. 

In March, I ran my first 10k in over 9 months. The muscle atrophy was clear, but my soul felt better than ever. In August, I left my heel insoles behind, and it was the first time I ran without any aids in over a year.

I can say that my pain, although still present, is less than 10% of what it originally was. Today, I can confidently say I am able to go back to running without worrying about the pain the day after.

Was it the weight loss, the ultrasound therapy, the shoes, or the forced resting time? Who knows. It's difficult to isolate the effect of each one of the methods on my body. I cannot attribute my recovery to a single method. However, I can certainly say that the human body is a highly interconnected system. When in pain, the source may not be where it hurts but somewhere else.

I would like to mention one thing, though. Back in March, on my way back to Germany from Colombia, my mother insisted I try the nopal leaf remedy. It couldn't hurt, so why not? Months later, shortly after I resumed my old running routine, she called me to share that the nopal leaves had dried up.
















### The Scenarios

The premise of the question went along the lines of: Picture a DAG with a root node named `model_alpha` and two directed edges leading to two nodes, `model_beta_a` and `model_beta_b.` Each of these nodes connects to its own set of leaf nodes, `model_gamma_a` and `model_gamma_b.`






The question posed was: In a scenario where this DAG is run using two threads, with the *fail fast* argument enabled, what would happen if `model_beta_a` encounters an error?

To tackle this question, we'll explore three scenarios using the hypothetical DAG, aiming to observe the differences between running it with a single thread and running it with two threads. The three scenarios are:

1. **Smooth Run**: Executing the DAG without any errors.
2. **Error Run**: Running the DAG where `model_beta_a` encounters a division-by-zero error.
3. **Fail-Fast Error Run**: Executing the DAG with `model_beta_a` encountering a division-by-zero error and the *fail-fast* argument enabled.

All three scenarios are conducted using `dbt core 1.6.1` with the `bigquery plugin 1.6.4`. For simplicity, all models use materialization of type table.


### Some Background

In the context of dbt, a [*thread*](https://docs.getdbt.com/docs/running-a-dbt-project/using-threads) represents a path of ordered commands. The number of threads determines the maximum number of paths dbt will concurrently process when executing a DAG. You can specify the number of threads in the *profiles.yml* file or directly through the dbt command using the `--threads` argument.

Once the order and the number of paths are determined, dbt proceeds with the compilation and execution of each node. Compilation involves assembling queries and syntax error checking, followed by execution of the compiled query on the target database.

Results and metadata from each dbt run are display in the command-line interface (CLI) and also stored in the *target/run_results.json* file. This file is updated with each successful run.

### Smooth Run

In this scenario, we initiate the DAG run with the command `dbt run --threads 1`.



<script src="https://gist.github.com/moralescastillo/e46d0272c3e591c57c40e3bfae51ca55.js"></script>
<font size="-1"><center><span> CLI results from <code>dbt run --threads 1</code> within the smooth run scenario </span></center></font>
<br>

<!---
https://gist.github.com/e46d0272c3e591c57c40e3bfae51ca55.git
-->



The execution proceeds as expected, with all models being ordered, compiled, and executed in succession. The CLI provides a summary of time results in seconds, while the target folder contains more detailed timing information.



![2023-09-05-dbt-dag-thread-img02](/images/2023-09-05-dbt-dag-thread-img02.jpg){:loading="lazy"}
<font size="-1"><center><span> Model execution order, threads and status according to results from the smooth run scenario with one threads </span></center></font>
<br>


  
One observation to be made is that model compilation doesn't begin until the preceding model's execution is completed. 



![2023-09-05-dbt-dag-thread-img04](/images/2023-09-05-dbt-dag-thread-img04.jpg){:loading="lazy"}
<font size="-1"><center><span> Timeline of compilation and execution for beta models from the smooth run scenario with one thread </span></center></font>
<br>



Now, let's compare this to the two-thread run with `dbt run --threads 2.`



<script src="https://gist.github.com/moralescastillo/60da308981ac21bc772da11ecd30e70b.js"></script>
<font size="-1"><center><span> CLI results from <code>dbt run --threads 2</code> within the smooth run scenario </span></center></font>
<br>

<!---
https://gist.github.com/60da308981ac21bc772da11ecd30e70b.git
-->




As expected, running the DAG with two threads results in a slightly shorter execution time compared to a single-thread run. 



![2023-09-05-dbt-dag-thread-img03](/images/2023-09-05-dbt-dag-thread-img03.jpg){:loading="lazy"}
<font size="-1"><center><span> Model execution order, threads and status according to results from the smooth run scenario with two threads </span></center></font>
<br>

  

Under the two-thread case, two observations are worth mentioning. Firstly, despite using separate threads and identical queries, both beta models start and end at different times. 



![2023-09-05-dbt-dag-thread-img05](/images/2023-09-05-dbt-dag-thread-img05.jpg){:loading="lazy"}
<font size="-1"><center><span> Timeline of compilation and execution for beta models from the smooth run scenario with two threads </span></center></font>
<br>

  

Secondly, unlike the single-thread case, compilation and execution in the two-thread case occur concurrently for the beta models.

### Error Run

In this scenario, we intentionally introduce a division-by-zero error in `model_beta_a` to force an error during the DAG run. We then execute the command `dbt run --threads 1`.



<script src="https://gist.github.com/moralescastillo/a8f073593d073695c7b06cd8bd576327.js"></script>
<font size="-1"><center><span> CLI results from <code>dbt run --threads 1</code> within the error run scenario </span></center></font>
<br>

<!---
https://gist.github.com/a8f073593d073695c7b06cd8bd576327.git
-->




As expected, `model_beta_a` is compiled and executed but fails to materialize due to the error. As a result of its dependency, `model_gamma_a` is skipped, and materialization doesn't occur. Consistent with single-thread execution, compilation of `model_beta_b` starts after `model_beta_a`'s execution ends.



![2023-09-05-dbt-dag-thread-img06](/images/2023-09-05-dbt-dag-thread-img06.jpg){:loading="lazy"}
<font size="-1"><center><span> Model execution order, threads and status according to target results from the error run scenario with one thread </span></center></font>
<br>



Now, let's run the same DAG with two threads with the command `dbt run --threads 2`. 



<script src="https://gist.github.com/moralescastillo/ceb82855fb2e1a3aaec0f89ffe1d17ec.js"></script>
<font size="-1"><center><span> CLI results from <code>dbt run --threads 2</code> within the error run scenario </span></center></font>
<br>

<!---
https://gist.github.com/ceb82855fb2e1a3aaec0f89ffe1d17ec.git
-->



Similar to the single-thread case, `model_beta_a` and `model_gamma_a` do not materialize in the two-thread case. Also, compilation and execution of the beta models occur concurrently, just as in the smooth run.


![2023-09-05-dbt-dag-thread-img09](/images/2023-09-05-dbt-dag-thread-img09.jpg){:loading="lazy"}
<font size="-1"><center><span> Model execution order, threads and status according to target results from the error run scenario with two threads </span></center></font>
<br>



### Fail-Fast Error Run

We now introduce the *fail-fast* argument into our DAG run using the command `dbt run --threads 1 --fail-fast`. 

Our aim is to analyze results from both the CLI and the target folder, specifically focusing on what happens to the remaining models after `model_beta_a` encounters an error.



<script src="https://gist.github.com/moralescastillo/a8a2a6c0b2f940b556be98baf92a200e.js"></script>
<font size="-1"><center><span> CLI results from <code>dbt run --threads 1 --fail-fast</code> within the fail-fast error run scenario </span></center></font>
<br>

<!---
https://gist.github.com/a8a2a6c0b2f940b556be98baf92a200e.git
-->



At this point the results become interesting. In the single-thread case, there are discrepancies between the CLI and target results. 

As seen in the CLI results, `model_beta_a` encounters an error and fails to materialize. Surprisingly, despite the single-thread setup, and the fact that models are compiled and executed successively, `model_beta_b` is given a green light to run.

Then, `model_beta_b` cannot be stopped, as stated in the CLI: "The bigquery adapter does not support query cancellation." In the end, the model is materialized. 

This story contrasts with the target results. A quick inspection indicates that `model_beta_b` is skipped "due to fail fast." Naturally, since the model was skipped, there is no record of compilation and execution times.



![2023-09-05-dbt-dag-thread-img07](/images/2023-09-05-dbt-dag-thread-img07.jpg){:loading="lazy"}
<font size="-1"><center><span> Model execution order, threads and status according to target results from the fail-fast error run scenario with one thread </span></center></font>
<br>



Lastly, we run `dbt run --threads 2 --fail-fast`. 



<script src="https://gist.github.com/moralescastillo/ef013fc6fb64b4f6304a13b319668b57.js"></script>
<font size="-1"><center><span> CLI results from <code>dbt run --threads 2 --fail-fast</code> within the fail-fast error run scenario </span></center></font>
<br>

<!---
https://gist.github.com/ef013fc6fb64b4f6304a13b319668b57.git
-->



Similar to the single-thread case, the CLI reports that `model_beta_b` is triggered and materialized. Yet, once again, the target results suggest this model was skipped.



![2023-09-05-dbt-dag-thread-img08](/images/2023-09-05-dbt-dag-thread-img08.jpg){:loading="lazy"}
<font size="-1"><center><span> Model execution order, threads and status according to target results from the fail-fast error run scenario with two threads </span></center></font>
<br>



  
### Conclusion

In summary, we see that the execution of a DAG respects dependencies. If an upstream model fails, downstream models are skipped, regardless of the number of threads. However, the execution of a DAG does not consistently respect the *fail fast* argument.

So, what is the answer to the original question? The answer is, it depends.

In theory, models running in parallel in a two-thread environment should be canceled and marked as skipped. 

Yet, in practice, whether a model running in parallel is run and materialized depends on the dbt adapter's support for query cancelation. In the case of the BigQuery adapter, it does not seem to support query cancelation. Thus models running in parallel could still be materialized.
